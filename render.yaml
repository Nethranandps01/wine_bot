services:
  # -------------------------------------------------------------------
  # BACKEND SERVICE (FastAPI)
  # -------------------------------------------------------------------
  - type: web
    name: wine-bot-backend
    env: python
    rootDir: backend
    plan: free
    buildCommand: "pip install -r requirements.txt"
    startCommand: "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.3
      - key: GEMINI_API_KEY
        sync: false
      - key: GEMINI_LIVE_MODEL
        value: "models/gemini-2.5-flash-native-audio-preview-12-2025"
      - key: GEMINI_TTS_VOICE
        value: "Kore"
      - key: USE_DUMMY_GEMINI
        value: "false"

  # -------------------------------------------------------------------
  # FRONTEND SERVICE (Next.js)
  # -------------------------------------------------------------------
  - type: web
    name: wine-bot-frontend
    env: node
    plan: free
    buildCommand: "npm install -g pnpm && pnpm install && pnpm build"
    startCommand: "pnpm start"
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: NEXT_PUBLIC_BACKEND_WS_URL
        fromService:
          type: web
          name: wine-bot-backend
          property: hostAndPort
          # hostAndPort gives "hostname:port"; prepend wss:// and append /ws/chat
      - key: NEXT_PUBLIC_RENDER_BACKEND_HOST
        fromService:
          type: web
          name: wine-bot-backend
          property: host
